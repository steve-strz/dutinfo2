#include <pthread.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <assert.h>

void* function_thread(void* arg);

int compteur = 0;

int main(int argc, char *argv[]){
  if(argv[1] != NULL){
    const long NB_THREADS = atol(argv[1]);
    pthread_t thr[NB_THREADS];
    for(long i = 0; i < NB_THREADS;i++){
      if(pthread_create(&thr[i], NULL, function_thread,(void*) i) != 0){
        fprintf(stderr, "ERREUR dans pthread_create\n");
        exit(EXIT_FAILURE);
      }
    }
    while(1){
      fprintf(stderr, "Thread Main, compteur = %d\n", compteur);
      sleep(1);
    }
  }else{
    printf("Il manque le nombre de threads");
    return -1;
  }
}

void* function_thread(void* arg){
  long num = (long) arg;
  while(1){
    fprintf(stderr, "Thread numero %ld , compteur = %d \n",num+1, compteur);
    compteur++;
    sleep(1);
  }
}